YUI.add("gallery-sm-editor",function(e,t){var n=e.config.doc,r=e.ClassNameManager.getClassName;e.Node.DOM_EVENTS.paste=1;var i="selectionChange";e.Editor=e.Base.create("editor",e.View,[],{classNames:{editor:r("sm-editor",!0),input:r("sm-editor-input",!0)},styleCommands:{bold:"boolean",italic:"boolean",fontName:"string",fontSize:"string",underline:"boolean"},initializer:function(){this._updateSelection({silent:!0}),this.selectors={},e.Object.each(this.classNames,function(e,t){this.selectors[t]="."+e},this),this._attachEvents()},destructor:function(){this._detachEvents()},blur:function(){return this._inputNode&&this._inputNode.blur(),this},command:function(e,t){return t&&this._execCommand(e,t),this._queryCommandValue(e)},focus:function(){return this._inputNode&&this._inputNode.focus(),this},render:function(){var t=this.get("container"),n=t.one(this.selectors.input);t.addClass(this.classNames.editor),n||(n=t.appendChild("<div/>").addClass(this.classNames.input));var r=this.get("html"),i=this.get("text");return r?n.setHTML(r):i&&n.set("text",i),n.set("contentEditable",!0),t.inDoc()||e.one("body").append(t),this._inputNode=n,this._rendered=!0,this},style:function(t,n){if(!this.styleCommands.hasOwnProperty(t)){e.error("sm-editor: Unsupported style: "+t);return}return this.command(t,n)},styles:function(e){var t={},n;if(e)for(n in e)e.hasOwnProperty(n)&&(t[n]=this.style(n,e[n]));else{var r=this.styleCommands;for(n in r)r.hasOwnProperty(n)&&(t[n]=this._queryCommandValue(n))}return t},_attachEvents:function(){if(this._events)return;var e=this.get("container"),t=this.selectors;this._events=[e.delegate("blur",this._onBlur,t.input,this),e.delegate("focus",this._onFocus,t.input,this),e.delegate("keydown",this._onKeyDown,t.input,this)]},_detachEvents:function(){this._events&&((new e.EventHandle(this._events)).detach(),this._events=null)},_execCommand:function(e,t){var r=this.styleCommands[e];if(!n.queryCommandEnabled(e))return;r==="boolean"?(t==="toggle"||t!==this._queryCommandValue(e))&&n.execCommand(e,!1,null):n.execCommand(e,!1,t)},_getHTML:function(e){return this._rendered?this._inputNode.getHTML():e},_getText:function(e){return this._rendered?this._inputNode.get("text"):e},_queryCommandValue:function(e){return this.styleCommands[e]==="boolean"?!!n.queryCommandState(e):n.queryCommandValue(e)},_setHTML:function(e){return this._rendered&&this._inputNode.setHTML(e),e},_setText:function(e){return this._rendered&&this._inputNode.set("text",e),e},_updateSelection:function(t){var n=this._selection||(this._selection=new e.Selection),r=this._selectedRanges,s=n.ranges(),o=!0,u,a,f;if(r&&r.length===s.length){for(a=0,f=r.length;a<f;a++)if(!r[a].isEquivalent(s[a])){u=!0;break}}else u=!0;if(u){for(a=0,f=s.length;a<f;a++)if(!s[a].isInsideNode(this._inputNode)){o=!1;break}this._selectedRanges=o?s:[],(!t||!t.silent)&&this.fire(i,{newRanges:this._selectedRanges,oldRanges:r,selection:this._selection})}},_onBlur:function(){clearInterval(this._selectionMonitor),this._updateSelection()},_onFocus:function(){var e=this;this._updateSelection(),clearInterval(this._selectionMonitor),this._selectionMonitor=setInterval(function(){e._updateSelection()},200)},_onKeyDown:function(e){if(e.shiftKey||e.altKey||!e.ctrlKey&&!e.metaKey)return;switch(e.charCode){case 66:this.style("bold","toggle");break;case 73:this.style("italic","toggle");break;case 85:this.style("underline","toggle");break;default:return}e.preventDefault()}},{ATTRS:{html:{getter:"_getHTML",setter:"_setHTML",value:""},outputName:{value:"editor",writeOnce:"initOnly"},text:{getter:"_getText",setter:"_setText",value:""}}})},"@VERSION@",{requires:["base-build","classnamemanager","event-focus","gallery-sm-selection","view"],skinnable:!0});
