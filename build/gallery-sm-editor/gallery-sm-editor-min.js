YUI.add("gallery-sm-editor",function(e,t){var n=e.config.doc,r=e.ClassNameManager.getClassName;e.Node.DOM_EVENTS.paste=1;var i="selectionChange";e.Editor=e.Base.create("editor",e.View,[],{classNames:{cursor:r("sm-editor-cursor",!0),editor:r("sm-editor",!0),input:r("sm-editor-input",!0)},ignoreKeyCodes:{16:"shift",17:"ctrl",18:"alt",91:"leftmeta",93:"rightmeta",224:"meta"},keyCodeMap:{8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pgup",34:"pgdown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",49:"!",61:"=",173:"-",187:"=",189:"-",190:".",191:"?",219:"[",221:"]"},keyCommands:{"ctrl+-":"decreaseFontSize","ctrl+=":"increaseFontSize","ctrl+b":"bold","ctrl+i":"italic","ctrl+u":"underline","ctrl+z":"undo","ctrl+shift+z":"redo",backspace:{fn:"_addUndo",allowDefault:!0},"ctrl+x":{fn:"_addUndo",allowDefault:!0},"ctrl+v":{fn:"_addUndo",allowDefault:!0},"delete":{fn:"_addUndo",allowDefault:!0},enter:{fn:"_addUndo",allowDefault:!0,async:!0},".":{fn:"_addUndo",allowDefault:!0,async:!0},"shift+!":{fn:"_addUndo",allowDefault:!0,async:!0},"shift+?":{fn:"_addUndo",allowDefault:!0,async:!0},tab:"_insertTab"},styleCommands:{bold:"boolean",italic:"boolean",fontName:"string",fontSize:"string",underline:"boolean"},initializer:function(){this.selection=new e.Selection,this.selectors={},this._redoStack=[],this._undoStack=[],this._cursorHTML='<span class="'+this.classNames.cursor+'"></span>',e.Object.each(this.classNames,function(e,t){this.selectors[t]="."+e},this),this._attachEvents()},destructor:function(){this._detachEvents(),this.selection=null,this._redoStack=null,this._undoStack=null},blur:function(){return this._inputNode&&this._inputNode.blur(),this},bold:function(){return this.style("bold","toggle"),this},command:function(e,t){return typeof t!="undefined"&&this._execCommand(e,t),this._queryCommandValue(e)},decreaseFontSize:function(){var e=parseInt(this.style("fontSize"),10)-1;return e>0&&this.style("fontSize",""+e),this},focus:function(){return this._inputNode&&this._inputNode.focus(),this},increaseFontSize:function(){var e=parseInt(this.style("fontSize"),10)+1;return e<8&&this.style("fontSize",""+e),this},insertHTML:function(t){var n=typeof t=="string"?e.Node.create(t):t,r=this.selection,i=r.range();if(!i)return;return this._addUndo(),n=i.deleteContents().insertNode(n),i.collapse(),r.select(i),n},insertText:function(e){return this.insertHTML(n.createTextNode(e))},italic:function(){return this.style("italic","toggle"),this},redo:function(){var t=this._redoStack.pop();if(typeof t!="string")return this;if(t.replace(this._cursorHTML,"")===this._inputNode.getHTML())return this.redo();this._addUndo(),this._inputNode.setHTML(t);var n=this._inputNode.one(this.selectors.cursor);if(n){var r=new e.Range;r.startNode(n,"after"),this.selection.select(r),n.remove(!0)}return this},render:function(){var t=this.get("container"),n=t.one(this.selectors.input);t.addClass(this.classNames.editor),n||(n=t.appendChild("<div/>").addClass(this.classNames.input));var r=this.get("html"),i=this.get("text");return r?n.setHTML(r):i&&n.set("text",i),n.set("contentEditable",!0),t.inDoc()||e.one("body").append(t),this._inputNode=n,this._rendered=!0,this._updateSelection({silent:!0}),this._addUndo(),this},style:function(t,n){if(!this.styleCommands.hasOwnProperty(t)){e.error("sm-editor: Unsupported style: "+t);return}return this.command(t,n)},styles:function(e){var t={},n;if(e)for(n in e)e.hasOwnProperty(n)&&(t[n]=this.style(n,e[n]));else{var r=this.styleCommands;for(n in r)r.hasOwnProperty(n)&&(t[n]=this._queryCommandValue(n))}return t},underline:function(){return this.style("underline","toggle"),this},undo:function(){var t=this._undoStack.pop();if(typeof t!="string")return this;if(t.replace(this._cursorHTML,"")===this._inputNode.getHTML())return this.undo();this._addRedo(),this._inputNode.setHTML(t);var n=this._inputNode.one(this.selectors.cursor);if(n){var r=new e.Range;r.startNode(n,"after"),this.selection.select(r),n.remove(!0)}return this},_addUndo:function(){var t=this.selection.range(),n=this._undoStack,r;t&&(r=t.insertNode(e.Node.create(this._cursorHTML)),this.selection.select(t));var i=this._inputNode.getHTML();r&&r.remove(!0),n.push(i)>this.get("undoLevels")&&n.shift()},_addRedo:function(){var t=this.selection.range(),n=this._redoStack,r;t&&(r=t.insertNode(e.Node.create(this._cursorHTML)),this.selection.select(t));var i=this._inputNode.getHTML();r&&r.remove(!0),n.push(i)>this.get("undoLevels")&&n.shift()},_attachEvents:function(){if(this._events)return;var e=this.get("container"),t=this.selectors;this._events=[e.delegate("blur",this._onBlur,t.input,this),e.delegate("focus",this._onFocus,t.input,this),e.delegate("keydown",this._onKeyDown,t.input,this)]},_detachEvents:function(){this._events&&((new e.EventHandle(this._events)).detach(),this._events=null)},_execCommand:function(e,t){var r=this.styleCommands[e];if(!n.queryCommandEnabled(e))return;if(r==="boolean"){if(t==="toggle"||t!==this._queryCommandValue(e))this._addUndo(),n.execCommand(e,!1,null)}else/^(?:redo|undo)$/i.test(e)||this._addUndo(),n.execCommand(e,!1,t)},_getHTML:function(e){return this._rendered?this._inputNode.getHTML():e},_getText:function(e){return this._rendered?this._inputNode.get("text"):e},_insertTab:function(){this.insertHTML('<span style="white-space:pre;">	</span>')},_queryCommandValue:function(e){return this.styleCommands[e]==="boolean"?!!n.queryCommandState(e):n.queryCommandValue(e)},_setHTML:function(e){return this._rendered&&this._inputNode.setHTML(e),e},_setText:function(e){return this._rendered&&this._inputNode.set("text",e),e},_updateSelection:function(e){var t=this.selection,n=this._selectedRange,r=t.range(),s;n?s=!r||n.isEquivalent(r):r&&(s=!0),s&&(this._selectedRange=r.isInsideNode(this._inputNode)?r:null,(!e||!e.silent)&&this.fire(i,{newRange:this._selectedRange,oldRange:n,selection:this.selection}))},_onBlur:function(){if(!this._rendered)return;clearInterval(this._selectionMonitor),this._updateSelection()},_onFocus
:function(){var e=this;if(!this._rendered)return;this._updateSelection(),clearInterval(this._selectionMonitor),this._selectionMonitor=setInterval(function(){e._updateSelection()},200)},_onKeyDown:function(e){var t=e.keyCode;if(this.ignoreKeyCodes[t])return;var n=[];e.altKey&&n.push("alt"),(e.ctrlKey||e.metaKey)&&n.push("ctrl"),e.shiftKey&&n.push("shift"),n.push(this.keyCodeMap[t]||String.fromCharCode(t).toLowerCase());var r=this.keyCommands[n.join("+")];if(r){var i=r.fn||r,s=this;typeof i=="string"&&(i=this[i]),r.allowDefault||e.preventDefault(),r.async?setTimeout(function(){i.call(s,e,n)},0):i.call(this,e,n)}}},{ATTRS:{html:{getter:"_getHTML",setter:"_setHTML",value:""},outputName:{value:"editor",writeOnce:"initOnly"},text:{getter:"_getText",setter:"_setText",value:""},undoLevels:{value:20}}})},"@VERSION@",{requires:["base-build","classnamemanager","event-focus","gallery-sm-selection","view"],skinnable:!0});
